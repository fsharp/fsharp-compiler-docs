<!DOCTYPE html>
<html lang="en" data-root="https://fsharp.github.io/fsharp-compiler-docs/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="F# Software Foundation; Microsoft; F# Contributors" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="F# Compiler Guide">
    <meta property="og:title" content="Compiling Equality
" />
    <meta property="og:url" content="https://fsharp.github.io/fsharp-compiler-docs/optimizations-equality.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="https://fsharp.github.io/fsharp-compiler-docs/">
    <meta name="twitter:title" content="Compiling Equality
">
    
    <title>Compiling Equality
 | F# Compiler Guide</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="https://fsharp.github.io/fsharp-compiler-docs/img/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-theme-set-dark.js"></script>
    <script type="application/javascript" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-details-set-expanded.js"></script>
    <link href="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    
    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/dotnet/fsharp/blob/main/License.txt">License</a>
                </li>
                <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                        href="https://github.com/dotnet/fsharp/blob/main/release-notes.md">Release
                    Notes</a></li>
                <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/dotnet/fsharp/">Source
                    Repository</a></li>
                <li class="nav-header ">
  Compiler Internals
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/reusing-typechecking-results.html">
    Reusing typechecking results
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/overview.html">
    Overview
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/coding-standards.html">
    Coding standards
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/representations.html">
    Representations
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/debug-emit.html">
    Debug emit
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/names.html">
    Display names, logical names and compiled names
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fsi-emit.html">
    F# Interactive Emit
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/optimizations.html">
    Optimizations
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/large-inputs-and-stack-overflows.html">
    Large inputs
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/memory-usage.html">
    Memory usage
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/compiler-startup-performance.html">
    Startup Performance
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/changing-the-ast.html">
    Changing the AST
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/running-documentation-locally.html">
    Running the documentation locally
  </a>
</li>             
<li class="nav-header ">
  Language Service Internals
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/tooling-features.html">
    Overview
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/project-builds.html">
    Project builds
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/caches.html">
    FSharpChecker caches
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/react.html">
    Incrementality
  </a>
</li>             
<li class="nav-header ">
  FSharp.Compiler.Service
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/tokenizer.html">
    Tutorial: Tokenizing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/untypedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/untypedtree-apis.html">
    Tutorial: AST APIs
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/symbols.html">
    Tutorial: Symbols
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/editor.html">
    Tutorial: Editor services
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/typedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/project.html">
    Tutorial: Project analysis
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/interactive.html">
    Tutorial: Hosted execution
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/compiler.html">
    Tutorial: Hosting the compiler
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/corelib.html">
    Notes on FSharp.Core
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/filesystem.html">
    IFileSystem
  </a>
</li>             
<li class="nav-header ">
  FSharp.Core
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fsharp-core-notes.html">
    Guidance
  </a>
</li>             
<li class="nav-header ">
  Release Notes
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/About.html">
    About
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/Language.html">
    F# Language
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/FSharp.Core.html">
    FSharp.Core
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/FSharp.Compiler.Service.html">
    FSharp.Compiler.Service
  </a>
</li>             
<li class="nav-header active">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/perf-discussions-archive.html">
    Comparisons

  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/optimizations-equality.html">
    Compiling Equality

  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/lsp.html">
    F# LSP

  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
        <a href="https://fsharp.github.io/fsharp-compiler-docs/">
            <img alt="Header menu logo" src="https://fsharp.github.io/fsharp-compiler-docs/img/logo.png">
            <strong>F# Compiler Guide</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/dotnet/fsharp/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/dotnet/fsharp/blob/main/License.txt">License</a>
        </li>
        <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                href="https://github.com/dotnet/fsharp/blob/main/release-notes.md">Release
            Notes</a></li>
        <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/dotnet/fsharp/">Source
            Repository</a></li>
        <li class="nav-header ">
  Compiler Internals
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/reusing-typechecking-results.html">
    Reusing typechecking results
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/overview.html">
    Overview
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/coding-standards.html">
    Coding standards
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/representations.html">
    Representations
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/debug-emit.html">
    Debug emit
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/names.html">
    Display names, logical names and compiled names
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fsi-emit.html">
    F# Interactive Emit
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/optimizations.html">
    Optimizations
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/large-inputs-and-stack-overflows.html">
    Large inputs
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/memory-usage.html">
    Memory usage
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/compiler-startup-performance.html">
    Startup Performance
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/changing-the-ast.html">
    Changing the AST
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/running-documentation-locally.html">
    Running the documentation locally
  </a>
</li>             
<li class="nav-header ">
  Language Service Internals
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/tooling-features.html">
    Overview
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/project-builds.html">
    Project builds
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/caches.html">
    FSharpChecker caches
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/react.html">
    Incrementality
  </a>
</li>             
<li class="nav-header ">
  FSharp.Compiler.Service
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/tokenizer.html">
    Tutorial: Tokenizing
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/untypedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/untypedtree-apis.html">
    Tutorial: AST APIs
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/symbols.html">
    Tutorial: Symbols
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/editor.html">
    Tutorial: Editor services
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/typedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/project.html">
    Tutorial: Project analysis
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/interactive.html">
    Tutorial: Hosted execution
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/compiler.html">
    Tutorial: Hosting the compiler
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/corelib.html">
    Notes on FSharp.Core
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/filesystem.html">
    IFileSystem
  </a>
</li>             
<li class="nav-header ">
  FSharp.Core
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fsharp-core-notes.html">
    Guidance
  </a>
</li>             
<li class="nav-header ">
  Release Notes
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/About.html">
    About
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/Language.html">
    F# Language
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/FSharp.Core.html">
    FSharp.Core
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/release-notes/FSharp.Compiler.Service.html">
    FSharp.Compiler.Service
  </a>
</li>             
<li class="nav-header active">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/perf-discussions-archive.html">
    Comparisons

  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/optimizations-equality.html">
    Compiling Equality

  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/lsp.html">
    F# LSP

  </a>
</li>
        <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/reference/index.html">
    All Namespaces
  </a>
</li>
    </ul>
</aside>
<main>
    <div id="content">
        <h1><a name="Compiling-Equality" class="anchor" href="#Compiling-Equality">Compiling Equality</a></h1>
<p>This spec covers how equality is compiled and executed by the F# compiler and library, based mainly on the types involved in the equality operation after all inlining, type specialization and other optimizations have been applied.</p>
<h2><a name="What-do-we-mean-by-an-equality-operation" class="anchor" href="#What-do-we-mean-by-an-equality-operation">What do we mean by an equality operation?</a></h2>
<p>This spec is about the semantics and performance of the following coding constructs</p>
<ul>
<li><code>a = b</code></li>
<li><code>a &lt;&gt; b</code></li>
</ul>
<p>It is also about the semantics and performance of uses of the following <code>FSharp.Core</code> constructs which, after inlining, generate code that contains an equality check at the specific <code>EQTYPE</code>
* <code>HashIdentity.Structural&lt;'T&gt;</code>
* <code>{Array,Seq,List}.contains</code>
* <code>{Array,Seq,List}.countBy</code>
* <code>{Array,Seq,List}.groupBy</code>
* <code>{Array,Seq,List}.distinct</code>
* <code>{Array,Seq,List}.distinctBy</code>
* <code>{Array,Seq,List}.except</code></p>
<p>All of which have implied equality checks. Some of these operations are inlined, see below, which in turn affects the semantics and performance of the overall operation.</p>
<h2><a name="ER-vs-PER-equality" class="anchor" href="#ER-vs-PER-equality">ER vs PER equality</a></h2>
<p>In math, a (binary) relation is a way to describe a relationship between the elements of sets. "Greater than" is a relation for numbers, "Subset of" is a relation for sets.</p>
<p>Here we talk about 3 particular relations:
1) <strong>Reflexivity</strong> - every element is related to itself
- For integers, <code>=</code> is reflexive (<code>a = a</code> is always true) and <code>&gt;</code> is not (<code>a &gt; a</code> is never true)
2) <strong>Symmetry</strong> - if <code>a</code> is related to <code>b</code>, then <code>b</code> is related to <code>a</code>
- For integers, <code>=</code> is symmetric (<code>a = b</code> -&gt; <code>b = a</code>) and <code>&gt;</code> is not (if <code>a &gt; b</code> then <code>b &gt; a</code> is false)
3) <strong>Transitivity</strong> -  if <code>a</code> is related to <code>b</code>, and <code>b</code> is related to <code>c</code>, then <code>a</code> is also related <code>c</code>
- For integers, <code>&gt;</code> is transitive (<code>a &gt; b</code> &amp;&amp; <code>b &gt; c</code> -&gt; <code>a &gt; c</code>) and <code>√</code> is not (<code>a = √b</code> &amp;&amp; <code>b = √c</code> doesn't mean <code>a = √c</code>)</p>
<p>If a relation has 1, 2, and 3, we talk about <strong>Equivalence Relation (ER)</strong>. If a relation only has 2 and 3, we talk about <strong>Partial Equivalence Relation (PER)</strong>.</p>
<p>This matters in comparing floats since they include <a href="https://en.wikipedia.org/wiki/NaN">NaN</a>. Depending on if we consider <code>NaN = NaN</code> true or false, we talk about ER or PER comparison respectively.</p>
<h2><a name="What-is-the-type-known-to-the-compiler-and-library-for-an-equality-operation" class="anchor" href="#What-is-the-type-known-to-the-compiler-and-library-for-an-equality-operation">What is the type known to the compiler and library for an equality operation?</a></h2>
<p>The static type known to the F# compiler is crucial to determining the performance of the operation. The runtime type of the equality check is also significant in some situations.</p>
<p>Here we define the relevant static type <code>EQTYPE</code> for the different constructs above:</p>
<h3><a name="Basics" class="anchor" href="#Basics">Basics</a></h3>
<ul>
<li><code>a = b</code>:  <code>EQTYPE</code> is the statically known type of <code>a</code> or <code>b</code></li>
<li><code>a &lt;&gt; b</code>: <code>EQTYPE</code> is the statically known type of <code>a</code> or <code>b</code></li>
</ul>
<h3><a name="Inlined-constructs" class="anchor" href="#Inlined-constructs">Inlined constructs</a></h3>
<ul>
<li><code>HashIdentity.Structural&lt;'T&gt;</code>, <code>EQTYPE</code> is the <strong>inlined</strong> <code>'T</code> (results in specialized equality)</li>
<li><code>Array.contains&lt;'T&gt;</code>, <code>EQTYPE</code> is the <strong>inlined</strong> <code>'T</code> (results in specialized equality)</li>
<li><code>List.contains&lt;T&gt;</code> likewise</li>
<li><code>Seq.contains&lt;T&gt;</code> likewise</li>
</ul>
<p>These only result in naked generic equality if themselves used from a non-inlined generic context.</p>
<h3><a name="Non-inlined-constructs-always-resulting-in-naked-generic-equality" class="anchor" href="#Non-inlined-constructs-always-resulting-in-naked-generic-equality">Non-inlined constructs always resulting in naked generic equality</a></h3>
<ul>
<li><code>Array.groupBy&lt;'Key, 'T&gt; f array</code>, <code>EQTYPE</code> is non-inlined <code>'Key</code>, results in naked generic equality</li>
<li><code>Array.countBy array</code> likewise for <code>'T</code></li>
<li><code>Array.distinct&lt;'T&gt; array</code> likewise</li>
<li><code>Array.distinctBy array</code> likewise</li>
<li><code>Array.except array</code> likewise</li>
<li><code>List.groupBy</code> likewise</li>
<li><code>List.countBy</code> likewise</li>
<li><code>List.distinct</code> likewise</li>
<li><code>List.distinctBy</code> likewise</li>
<li><code>List.except</code> likewise</li>
<li><code>Seq.groupBy</code> likewise</li>
<li><code>Seq.countBy</code> likewise</li>
<li><code>Seq.distinct</code> likewise</li>
<li><code>Seq.distinctBy</code> likewise</li>
<li><code>Seq.except</code> likewise</li>
</ul>
<p>These <strong>always</strong> result in naked generic equality checks.</p>
<p>Example 1:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="m">HashIdentity</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="id">Structural</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="vt">byte</span><span class="pn">&gt;</span>  <span class="c">// EQTYPE known to compiler is `byte`</span>
</code></pre>
<p>Example 2 (a non-inlined "naked" generic context):</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="fn">f2</span><span class="pn">&lt;</span><span class="ta">&#39;</span><span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="id">T</span><span class="pn">&gt;</span> <span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>
   <span class="c">// EQTYPE known to the compiler is `&#39;T`</span>
   <span class="c">// RUNTIME-EQTYPE known to the library is `byte`</span>
   <span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 7)" onmouseover="showTip(event, 'fs1', 7)" class="id">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 8)" onmouseover="showTip(event, 'fs2', 8)" class="id">HashIdentity</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 9)" onmouseover="showTip(event, 'fs3', 9)" class="id">Structural</span><span class="pn">&lt;</span><span class="id">&#39;</span><span class="id">T</span><span class="pn">&gt;</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>

<span class="id">f2</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 10)" onmouseover="showTip(event, 'fs4', 10)" class="id">byte</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="c">// performance of this is determined by EQTYPE&lt;&#39;T&gt; and RUNTIME-EQTYPE&lt;byte&gt;</span>
</code></pre>
<p>Example 3 (an inlined generic context):</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">f3</span><span class="pn">&lt;</span><span class="id">&#39;</span><span class="id">T</span><span class="pn">&gt;</span> <span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>
   <span class="c">// EQTYPE known to the compiler is `byte`</span>
   <span class="c">// RUNTIME-EQTYPE known to the library is `byte`</span>
   <span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="id">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 12)" onmouseover="showTip(event, 'fs2', 12)" class="id">HashIdentity</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 13)" onmouseover="showTip(event, 'fs3', 13)" class="id">Structural</span><span class="pn">&lt;</span><span class="id">&#39;</span><span class="id">T</span><span class="pn">&gt;</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>

<span class="id">f3</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 14)" onmouseover="showTip(event, 'fs4', 14)" class="id">byte</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="c">// performance of this is determined by EQTYPE&lt;byte&gt; and RUNTIME-EQTYPE&lt;byte&gt;</span>
</code></pre>
<p>Example 4 (a generic struct type in a non-inline generic context):</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">f4</span><span class="pn">&lt;</span><span class="id">&#39;</span><span class="id">T</span><span class="pn">&gt;</span> <span class="pn">(</span><span class="pn">)</span> <span class="o">=</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>
   <span class="c">// EQTYPE known to the compiler is `SomeStructType&lt;&#39;T&gt;`</span>
   <span class="c">// RUNTIME-EQTYPE known to the library is `SomeStructType&lt;byte&gt;`</span>
   <span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 15)" onmouseover="showTip(event, 'fs1', 15)" class="id">x</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 16)" onmouseover="showTip(event, 'fs2', 16)" class="id">HashIdentity</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs3', 17)" onmouseover="showTip(event, 'fs3', 17)" class="id">Structural</span><span class="pn">&lt;</span><span class="id">SomeStructType</span><span class="pn">&lt;</span><span class="id">&#39;</span><span class="id">T</span><span class="pn">&gt;</span><span class="pn">&gt;</span>
   <span class="o">..</span><span class="pn">.</span> <span class="id">some</span> <span class="id">long</span> <span class="id">code</span>

<span class="id">f4</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs4', 18)" onmouseover="showTip(event, 'fs4', 18)" class="id">byte</span><span class="pn">&gt;</span><span class="pn">(</span><span class="pn">)</span> <span class="c">// performance of this determined by EQTYPE&lt;SomeStructType&lt;&#39;T&gt;&gt; and RUNTIME-EQTYPE&lt;SomeStructType&lt;byte&gt;&gt;</span>
</code></pre>
<h2><a name="How-we-compile-equality-a-b" class="anchor" href="#How-we-compile-equality-a-b">How we compile equality "a = b"</a></h2>
<p>This very much depends on the <code>EQTYPE</code> involved in the equality as known by the compiler</p>
<p>Aim here is to flesh these all out with:
* <strong>Semantics</strong>: what semantics the user expects, and what the semantics actually is
* <strong>Perf expectation</strong>: what perf the user expects
* <strong>Compilation today</strong>: How we actually compile today
* <strong>Perf today</strong>: What is the perf we achieve today
* (Optional) sharplab.io link to how things are in whatever version is selected in sharplab
* (Optional) notes</p>
<h3><a name="primitive-integer-types" class="anchor" href="#primitive-integer-types">primitive integer types (<code>int32</code>, <code>int64</code>, ...)</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">f</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs1', 19)" onmouseover="showTip(event, 'fs1', 19)" class="id">x</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs7', 20)" onmouseover="showTip(event, 'fs7', 20)" class="id">int</span><span class="pn">)</span> <span class="pn">(</span><span class="id">y</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="id">int</span><span class="pn">)</span> <span class="o">=</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs1', 22)" onmouseover="showTip(event, 'fs1', 22)" class="id">x</span> <span class="o">=</span> <span class="id">y</span><span class="pn">)</span>
</code></pre>
<ul>
<li>Semantics: equality on primitive</li>
<li>Perf: User expects full performance down to native</li>
<li>Compilation today: compiles to IL instruction ✅</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNAJiDUAfYBTALgAjBgFADxAwEsA7NASlwE9DSKMBeXPRjK8gWACgg===">sharplab int32</a></li>
</ul>
<h3><a name="primitive-floating-point-types" class="anchor" href="#primitive-floating-point-types">primitive floating point types (<code>float32</code>, <code>float64</code>)</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">f</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs1', 23)" onmouseover="showTip(event, 'fs1', 23)" class="id">x</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs8', 24)" onmouseover="showTip(event, 'fs8', 24)" class="id">float32</span><span class="pn">)</span> <span class="pn">(</span><span class="id">y</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs8', 25)" onmouseover="showTip(event, 'fs8', 25)" class="id">float32</span><span class="pn">)</span> <span class="o">=</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs1', 26)" onmouseover="showTip(event, 'fs1', 26)" class="id">x</span> <span class="o">=</span> <span class="id">y</span><span class="pn">)</span>
</code></pre>
<ul>
<li>Semantics: IEEE floating point equality (respecting NaN etc.)</li>
<li>Perf: User expects full performance down to native</li>
<li>Compilation today: compiles to IL instruction ✅</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNAJiDUAfYBTALgAjBgFADxC2AHsBDNAZgCYBKXAT0LBPOroF5c8NP6aBYAFBA===">sharplab float32</a></li>
</ul>
<h3><a name="primitive" class="anchor" href="#primitive">primitive <code>string</code>, <code>decimal</code></a></h3>
<ul>
<li>Semantics: .NET equivalent equality, non-localized for strings</li>
<li>Perf: User expects full performance down to native</li>
<li>Compilation today: compiles to <code>String.Equals</code> or <code>Decimal.op_Equality</code> call ✅</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwoBMQGoA+wCmMAEYeAFAB4h7LYDG8AtgIbACUxAnuZTQ83gLzEk+eVkwCwAKCA">sharplab decimal</a></li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwoBMQGoA+wCmMAEYeAFAB4h4QwBO8AdgOYCUxAnuZTQ8wLzEl68WjALAAoIA==">sharplab string</a></li>
</ul>
<h3><a name="reference-tuple-type-size-lt-5" class="anchor" href="#reference-tuple-type-size-lt-5">reference tuple type (size &lt;= 5)</a></h3>
<ul>
<li>Semantics: User expects structural</li>
<li>Perf: User expects flattening to constituent checks</li>
<li>Compilation today: tuple equality is flattened to constituent checks ✅</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgPgsAUMApgFwARlQCgB4iwSwDs0AqVAEwHsBXAIyVTIHIAVASjdQE9UBeLbH25t48TCVFxB/LpIC0cosCJEA5goB8kgOKJCiAE74AxgFEAjtQCGy5D0Gy48BUpWF1crU7gAJKxAALAGFKAFsABysDRAA6XX0jM0sbfDsAMX80B1R5RUJlQjVNHT1DEwtrWy4ASWIjQggTAB4WAEZGVBYAJg6WAGYNVAdcgHlw5HxQ/AAvQ00sckQAN3wDNHiypMrUmrqiRuMRbwyIZAqbCBZqcKQ+1AAZK3drVUQABSMpiaXECDjSxIhCJRQwCVoAGmwXUhfU4mC4EK40K4sNyrkK7mK3iQaGMYUi0QMQkezysrw+k1S+B+fw2gPxIIM8Dp5WSVQA6qlggzCSdcTzQdh2gjUAAyUXMgGs7Z2TnIbnA3mZVB4xWCnpIsUSuAsrYpWVcoEEwx8lUConYO4o3KDSQ4s1qon8EmqF7vT5Umn/BImI2M+DGRDmIbC9rigNBoYanrhnVSvUcw3m2rIeoHB3Gi1WvqSEhHeBAA==">sharplab (int * double * 'T), with example reductions/optimizations noted</a></li>
</ul>
<h3><a name="reference-tuple-type-size-gt-5" class="anchor" href="#reference-tuple-type-size-gt-5">reference tuple type (size &gt; 5)</a></h3>
<ul>
<li>Semantics: User expects structural</li>
<li>Perf: User expects flattening to constituent checks</li>
<li>Compilation today: not flattened, compiled to <code>GenericEqualityIntrinsic</code></li>
<li>Perf today: the check does type tests, does virtual calls via <code>IStructuralEqualityComparer</code>, boxes etc. ❌(Problem1)</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgPgsAUMApgFwARlQCgB4iwSwDs0AqVI0841MimqyigSidQE9UBeLbL9p+EA==">sharplab for size 6</a></li>
</ul>
<h3><a name="struct-tuple-type" class="anchor" href="#struct-tuple-type">struct tuple type</a></h3>
<ul>
<li>Semantics: User expects structural</li>
<li>Perf: User expects flattening to constituent checks or at least the same optimizations as tuples</li>
<li>Compilation today: compiled to <code>GenericEqualityIntrinsic</code></li>
<li>Perf today: boxes, does type tests, does virtual calls via <code>IStructuralEqualityComparer</code> etc. ❌(Problem2)</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgPgsAUMApgFwARlQCgB4lRZAJwFcBjNTASwDs0AqVG+x2gSldQE9UBeLbXl1bwgA=">sharplab for size 3</a></li>
</ul>
<h3><a name="C-or-F-enum-type" class="anchor" href="#C-or-F-enum-type">C# or F# enum type</a></h3>
<ul>
<li>Semantics: User expects identical to equality on the underlying type</li>
<li>Perf: User expects same perf as flattening to underlying type</li>
<li>Compilation today: flattens to underlying type</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwA+BYAUMApjABGHAFAB4g4DKAnhDJgLYB0AIgIYUDyYA6ppgNYCUOCjgC8hIqKH90QA===">sharplab for C# enum int</a></li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwA+BYAUDAngBwKYAIBRfAXn3X0qXwEFT8BGCq/AIXoCZ11hcZ8w+ABQAPEEQCU+TPVH1ME9EA=">sharplab for F# enum int</a></li>
</ul>
<h3><a name="C-struct-type" class="anchor" href="#C-struct-type">C# struct type</a></h3>
<ul>
<li>Semantics: User expects call to <code>IEquatable&lt;T&gt;</code> if present, but F# spec says call <code>this.Equals(box that)</code>, in practice these are the same</li>
<li>Perf expected: no boxing</li>
<li>Compilation today: EqualityComparer<T>.Default</li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwA+BYAUMApjABGHAFAB4g4DKAnhDJgLYB0AIgIY0Aq8tmA8mJNgEocFHAF5CRMcIHogA==">sharplab</a></li>
</ul>
<h3><a name="F-struct-type-records-tuples-with-compiler-generated-structural-equality" class="anchor" href="#F-struct-type-records-tuples-with-compiler-generated-structural-equality">F# struct type (records, tuples - with compiler-generated structural equality)</a></h3>
<ul>
<li>Semantics: User expects field-by-field structural equality</li>
<li>Perf expected: no boxing</li>
<li>Compilation today: <code>GenericEqualityIntrinsic&lt;SomeStructType&gt;</code></li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgNALiCWwA+BYAUAbQDwGUYCcBXAYxgD4BddGATwAcBTAAhwHsBbBvI0gCgDcQTeADsYUJoSGiYASiYBedExVNO7AEYN8TAPoA6AGqKm/ZavVadBgKonC6dMAYwmYJrwAeQtp24k5JhoTLxMaWXQgA">sharplab</a></li>
</ul>
</details>
<h3><a name="array-type-byte-int-some-struct-type" class="anchor" href="#array-type-byte-int-some-struct-type">array type (byte[], int[], some-struct-type[],  ...)</a></h3>
<ul>
<li>Semantics: User expects structural</li>
<li>Perf expected: User expects perf is sum of constituent parts</li>
<li>Compilation today: either <code>FSharpEqualityComparer_PER`1&lt;uint8[]&gt;::get_EqualityComparer().Equals(...)</code> or <code>FSharpEqualityComparer_PER`1&lt;T[]&gt;::get_EqualityComparer().Equals(...)</code></li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgPgsAUMApgFwARlQCgB4lQIwE9lEBtAXQEpVDUBeLbemy+IA=">sharplab for <code>byte[]</code></a></li>
</ul>
<h3><a name="F-large-reference-record-union-type" class="anchor" href="#F-large-reference-record-union-type">F# large reference record/union type</a></h3>
<p>Here "large" means the compiler-generated structural equality is NOT inlined.</p>
<ul>
<li>Semantics: User expects structural by default</li>
<li>Perf expected: User expects perf is sum of constituent parts, type-specialized if generic</li>
<li>Compilation today: direct call to <code>Equals(T)</code></li>
<li>Perf today: the call to <code>Equals(T)</code> has specialized code but boxes fields if struct or generic, see Problem3 ❌, Problem4 ❌</li>
</ul>
<h3><a name="F-tiny-reference-anonymous-record-or-union-type" class="anchor" href="#F-tiny-reference-anonymous-record-or-union-type">F# tiny reference (anonymous) record or union type</a></h3>
<p>Here "tiny" means the compiler-generated structural equality IS inlined.</p>
<ul>
<li>Semantics: User expects structural by default</li>
<li>Perf expected: User expects perf is sum of constituent parts, type-specialized if generic</li>
<li>Compilation today: <code>FSharpEqualityComparer_ER`1&lt;!a&gt;::get_EqualityComparer().Equals(...)</code></li>
<li>Perf today: good ✅</li>
</ul>
<h3><a name="Generic-in-non-inlined-generic-code" class="anchor" href="#Generic-in-non-inlined-generic-code">Generic <code>'T</code> in non-inlined generic code</a></h3>
<ul>
<li>Semantics: User expects the PER equality semantics of whatever <code>'T</code> actually is</li>
<li>Perf expected: User expects no boxing</li>
<li>Compilation today: <code>FSharpEqualityComparer_ER`1&lt;!a&gt;::get_EqualityComparer().Equals(...)</code></li>
<li>Perf today: good ✅</li>
</ul>
<h3><a name="Generic-in-recursive-position-in-structural-comparison" class="anchor" href="#Generic-in-recursive-position-in-structural-comparison">Generic <code>'T</code> in recursive position in structural comparison</a></h3>
<p>This case happens in structural equality for tuple types and other structural types</p>
<ul>
<li>Semantics: User expects the PER equality semantics of whatever <code>'T</code> actually is</li>
<li>Perf: User expects no boxing</li>
<li>Compilation today: <code>FSharpEqualityComparer_ER`1&lt;!a&gt;::get_EqualityComparer().Equals(...)</code></li>
<li>Perf today: good ✅</li>
<li><a href="https://sharplab.io/#v2:DYLgZgzgPgsAUMApgFwARlQCgB4iwSwDs0AqVAEwHsBXAIyVTIHIAVASjdQE9UBeLbH25t48TCVFxB/LpIC0cosCJEA5goB8kgOKJCiAE74AxgFEAjtQCGy5D0Gy48BUpWF1crU7gAJKxAALAGFKAFsABysDRAA6XX0jM0sbfDsAMX80B1R5RUJlQjVNHT1DEwtrWy4ASWIjQggTAB4WAEZGVBYAJg6WAGYNVAdcgHlw5HxQ/AAvQ00sckQAN3wDNHiypMrUmrqiRuMRbwyIZAqbCBZqcKQ+1AAZK3drVUQABSMpiaXECDjSxIhCJRQwCVoAGmwXUhfU4mC4EK40K4sNyrkK7mK3iQaGMYUi0QMQkezysrw+k1S+B+fw2gPxIIM8Dp5WSVQA6qlggzCSdcTzQdh2gjUAAyUXMgGs7Z2TnIbnA3mZVB4xWCnpIsUSuAsrYpWVcoEEwx8lUConYO4o3KDSQ4s1qon8EmqF7vT5Umn/BImI2M+DGRDmIbC9rigNBoYanrhnVSvUcw3m2rIeoHB3Gi1WvqSEhHeBAA==">Sharplab</a></li>
</ul>
<h2><a name="Techniques-available-to-us" class="anchor" href="#Techniques-available-to-us">Techniques available to us</a></h2>
<ol>
<li>Flatten and inline</li>
<li>RCG: Use reflective code generation internally in FSharp.Core</li>
<li>KFS: Rely on known semantics of F# structural types and treat those as special</li>
<li>TS: Hand-code type-specializations using static optimization conditions in FSharp.Core</li>
<li>TT: Type-indexed tables of baked (poss by reflection) equality comparers and functions, where some pre-computation is done</li>
<li>DV: De-virtualization</li>
<li>DEQ: Use <code>EqualityComparer&lt;'T&gt;.Default</code> where possible</li>
</ol>
<h2><a name="Notes-on-previous-attempts-to-improve-things" class="anchor" href="#Notes-on-previous-attempts-to-improve-things">Notes on previous attempts to improve things</a></h2>
<h3><a name="5112" class="anchor" href="#5112"><a href="https://github.com/dotnet/fsharp/pull/5112">#5112</a></a></h3>
<ul>
<li>Uses TT, DEQ, KFS, DV</li>
<li>Focuses on solving Problem4</li>
<li>99% not breaking, apart from the case of value types with custom equality implemented differently than the <code>EqualityComparer.Default</code> - the change would lead to the usage of the custom implementation which is reasonable</li>
</ul>
<p>Note: this included <a href="https://github.com/dotnet/fsharp/pull/5112/files#diff-be48dbef2f0baca27a783ac4a31ec0aedb2704c7f42ea3a2b8228513f9904cfbR2360-R2363">changes to the optimizer to reduce GenericEqualityIntrinsic</a> down to a type-indexed table lookup fetching an <code>IEqualityComparer</code> and calling it. These hand-coded reductions appear unnecessary as the reduction doesn't open up any further optimizations.</p>

        <div class="fsdocs-tip" id="fs1">val x: System.Collections.Generic.IEqualityComparer&lt;byte&gt;</div>
<div class="fsdocs-tip" id="fs2">module HashIdentity

from Microsoft.FSharp.Collections</div>
<div class="fsdocs-tip" id="fs3">val Structural&lt;&#39;T (requires equality)&gt; : System.Collections.Generic.IEqualityComparer&lt;&#39;T&gt; (requires equality)</div>
<div class="fsdocs-tip" id="fs4">Multiple items<br />val byte: value: &#39;T -&gt; byte (requires member op_Explicit)<br /><br />--------------------<br />type byte = System.Byte<br /><br />--------------------<br />type byte&lt;&#39;Measure&gt; =
  byte</div>
<div class="fsdocs-tip" id="fs5">val f2&lt;&#39;T&gt; : unit -&gt; obj</div>
<div class="fsdocs-tip" id="fs6">&#39;T</div>
<div class="fsdocs-tip" id="fs7">Multiple items<br />val int: value: &#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; =
  int</div>
<div class="fsdocs-tip" id="fs8">Multiple items<br />val float32: value: &#39;T -&gt; float32 (requires member op_Explicit)<br /><br />--------------------<br />type float32 = System.Single<br /><br />--------------------<br />type float32&lt;&#39;Measure&gt; =
  float32</div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#Compiling-Equality">
      Compiling Equality
    </a>
  </li>
  <li class="level-2">
    <a href="#What-do-we-mean-by-an-equality-operation">
      What do we mean by an equality operation?
    </a>
  </li>
  <li class="level-2">
    <a href="#ER-vs-PER-equality">
      ER vs PER equality
    </a>
  </li>
  <li class="level-2">
    <a href="#What-is-the-type-known-to-the-compiler-and-library-for-an-equality-operation">
      What is the type known to the compiler and library for an equality operation?
    </a>
  </li>
  <li class="level-3">
    <a href="#Basics">
      Basics
    </a>
  </li>
  <li class="level-3">
    <a href="#Inlined-constructs">
      Inlined constructs
    </a>
  </li>
  <li class="level-3">
    <a href="#Non-inlined-constructs-always-resulting-in-naked-generic-equality">
      Non-inlined constructs always resulting in naked generic equality
    </a>
  </li>
  <li class="level-2">
    <a href="#How-we-compile-equality-a-b">
      How we compile equality "a = b"
    </a>
  </li>
  <li class="level-3">
    <a href="#reference-tuple-type-size-lt-5">
      reference tuple type (size &lt;= 5)
    </a>
  </li>
  <li class="level-3">
    <a href="#reference-tuple-type-size-gt-5">
      reference tuple type (size &gt; 5)
    </a>
  </li>
  <li class="level-3">
    <a href="#struct-tuple-type">
      struct tuple type
    </a>
  </li>
  <li class="level-3">
    <a href="#C-or-F-enum-type">
      C# or F# enum type
    </a>
  </li>
  <li class="level-3">
    <a href="#C-struct-type">
      C# struct type
    </a>
  </li>
  <li class="level-3">
    <a href="#F-struct-type-records-tuples-with-compiler-generated-structural-equality">
      F# struct type (records, tuples - with compiler-generated structural equality)
    </a>
  </li>
  <li class="level-3">
    <a href="#array-type-byte-int-some-struct-type">
      array type (byte[], int[], some-struct-type[],  ...)
    </a>
  </li>
  <li class="level-3">
    <a href="#F-large-reference-record-union-type">
      F# large reference record/union type
    </a>
  </li>
  <li class="level-3">
    <a href="#F-tiny-reference-anonymous-record-or-union-type">
      F# tiny reference (anonymous) record or union type
    </a>
  </li>
  <li class="level-2">
    <a href="#Techniques-available-to-us">
      Techniques available to us
    </a>
  </li>
  <li class="level-2">
    <a href="#Notes-on-previous-attempts-to-improve-things">
      Notes on previous attempts to improve things
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-tips.js"></script>
<script type="module" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-details-toggle.js"></script>
<script type="module" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-theme.js"></script>
<script type="module" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-search.js"></script>

</body>
</html>